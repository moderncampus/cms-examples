***The included source code, service and information is provided as is, and OmniUpdate makes no promises or guarantees about its use or misuse. The source code provided is recommended for advanced users and may not be compatible with all implementations of OU Campus.***

#Blog Notes

##Outline
A blog consists of three main parts, listing pages/assets, post files, and scripts. The blog listing page is a PCF which OU Campus outputs as an ASPX page with function calls to internal scripts, based on page parameters. See [Blog Listing Template](#listing) below for specific page params.  OU Campus holds each post as a PCF, XSL outputs two types of files, content (HTML) and data (XML). This data is taken upon page creation (ou-blog-post.tcf) and manually input via page properties and multi-edit.
Scripts are XSL and C#. XSL handles the XML output (.blog extension) and to a lesser extent the HTML - it's mostly just boring content. Blog Assets are handled with a template-match, see [Assets](#assets) for more detail. C# is used for server side query string based pagination, splitting up the full list. C# does the grunt work by crawling a given directory structure for XML post files, and displaying content with a bunch of different functions, more below.


##Structure
This is only a suggested structure, change it to suit your implementation.
* PCF
	* /blog/index.pcf
	* /blog/post/blog-post.pcf
* XSL
	* /\_resources/xsl/ou-blog/blog-functions.xsl
	* /\_resources/xsl/ou-blog/listing.xsl
	* /\_resources/xsl/ou-blog/post-xml.xsl
	* /\_resources/xsl/ou-blog/post.xsl
* C#
	* /\_resources/asp_scripts/blog/get-blog-rss.ashx
	* /App_Code/OUBlog.cs

###Templates

* Blog sections
	* Creates necessary resource folder (_nav) and a post listing.
	* You may want to impose template groups.
* Listing page
	* You may want more than the blog/index.pcf as a listing page, eg. a listing for each year.
* Post page

###PCF options

* <a name="listing">Listing page parameters</a>
	* "Display Featured" choose to display "featured post" slide show.
	* "Feature Limit" how many posts to display in slider.
	* "Year Filter" default is empty - all years.
	* "Posts per page" limits the number of posts shown before pagination.
	* "Add Tags" listing pages will display posts from within the directory (or sub directories) the listing page resides. This parameter will pull in posts from blogs anywhere on your site that are tagged with the specified values.  Comma separated list of tag values.
	* "Search Root" this param denotes where to begin the directory tree search for posts


* Post page
	* Parameters
		* "Enable Disqus Comments", default is off.
	* Multi-Edit (stores post data)
		* TCF Variables: title, description, author, date (auto generated by OU $CurrentDate), email, tags, featured post option.
		* PCF Properties: disqus (comments) toggle, date ("datetime" picker).
		* PCF Multi-Edit (not passed by TCF): display toggle and image.

* Tags
	* Via TCF tags are a list of check-box options, edit via an external include _/\_resources/templates/ou-blog/tags_options.inc_.
	* Tags on PCFs are comma-separated-values (text) allowing quick edits.

###Post Comments

Are powered by a _Disqus asset_. This asset should contain a unique "disqus_shortname" given when setup at https://disqus.com/.

	<div id="disqus_thread"></div>
		<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'REPLACE_ME'; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

Posts have the option to activate comments via properties, this is (most likely/ should be) an asset located in the XSL or an editable region of the PCF.
The Listing page should also contain disqus code to enable a count of comments for each post listed. Example:

	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'siast'; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function () {
			var s = document.createElement('script'); s.async = true;
			s.type = 'text/javascript';
			s.src = '//' + disqus_shortname + '.disqus.com/count.js';
			(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
		}());
	</script>

###<a name="assets">Assets</a>
Are meant to compliment the main listing of blog posts, with list of tags/categories, or recent posts, etc. They can be dropped on to any blog page and function.

Each asset is a single blog node with attributes defining it's output: __type__, __dir__, and __limit__. Example:

    <blog type"tags" dir="/" limit="0"/>

* Dir tells the C# scripts where to begin looking for _(.blog)_ post files which are XML.
* Type tells the XSL which C# display function to output.
* Limit is the number of items to display.
* Optional __tags__ attribute for type="byTag" as CSV, eg. tags="consetetur, dolor sit amet"

A template match converts this node as help text, for staging, and a C# statement for production. Each output is a simple `<ul><li>` list.

Types available: (all gather posts from defined _dir_, with respect to _limit_)

1. "tags" - posts by tags found in posts.
2. "recent" - posts by pubDate.
3. "featured" - posts marked as _featured_.
4. "related" - for __posts only__, takes current PCF _tags_ and displays all posts with matching tag.

Example: you want to display the five most recent posts from the academics blog:

    <blog type"recent" dir="/academics/blog/" limit="5"/>

Outputs:

	<%
	Response.Write(OUC.Blog.DisplayRecentPosts("/academics/blog/", "5"));
	%>

##Scripts
Each post PCF is processed by XSL to output only the essential data as XML. C# scripts combine to output different lists of posts, featured, recent, related, etc.

###XSL

####pubDate = dateTime
To prep the date variable "pubDate" an XSL function _(ou:toDateTime)_ converts the date given by the OU property _type="datetime"_ to a valid XSL dateTime object. This allows us to use XSL functions for dateTimes, namely _format-dateTime()_.

Note: post.tmpl uses the OU System Variable $CurrentDate to output "Friday, January 30, 2015 3:17:33 PM PST". However accessing and saving via parameters converts this date format to "01/30/2015 03:17:33 PM". _(ou:toDateTime)_ accounts for both formats.

Once we have a dateTime object we use _ou:pubDate()_ to output a valid "RFC822" pubDate string. This is required for a [valid RSS string](http://www.w3.org/Protocols/rfc822/#z28) and can be interpreted by C# easily. There are also smaller functions available to convert dates and times to friendly formats, _ou:displayLongDate()_, _ou:dayOfWeekAbbrevEn()_, etc.

###C# Classes in OUBlog.cs and the RSS WebHandler get-blog-rss.ashx

Your XSL should only be concerned with calling the approriate Display functions within class Blog.

####OUC.Blog
Display functions take parameters from XSL to crawl defined directories and extract data from posts XMLs.

####OUC.BlogPosts
Used to maintain a total count of available blog posts necessary for pagination

####OUC.BlogPost
A blog post data model/view class initialized by the root post node of the blog files on the server.  Blog posts can render themselves depending on the passed in conditions.

####get-blog-rss.ashx
Output a valid RSS feed based of URL parameters. By default [http://gpitts.w.oudemo.com/_resources/cs/get-blog-rss.ashx](http://gpitts.w.oudemo.com/_resources/cs/get-blog-rss.ashx) will return all blog posts. Valid URL params:

 * "dir" - The directory where the script should begin crawling for post files, defaults to blog root.
 * "limit" - Maximum number of posts returned, default "" returns all.
 * "tags" - Only return posts from specific tags, default "" no categorization.
 * "featured" - "true" to return only featured posts, default "false".
 * "year" - return posts from a specific year, default "" return all years.


![Greg](http://i.imgur.com/KF7r6bT.jpg)